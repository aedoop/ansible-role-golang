---
# tasks file for golang

- name: Check if the requested version already installed
  command: "go version"
  failed_when: false
  changed_when: false
  register: version_check_result

- name: Print info
  debug:
    var: version_check_result

- block:
  - name: Print info
    debug:
      var: version_check_result

  - name: Download golang package
    get_url: 
      url: "{{ golang_install_url }}"
      dest: "/tmp/golang.tar.gz"
  
  - name: Unpack the archive
    unarchive: 
      src: "/tmp/golang.tar.gz"
      dest: "{{golang_install_dir}}"
      copy: no

  - name: Add binaries to PATH if required
    template: src=golang.sh dest=/etc/profile.d/golang.sh

  - name: Remove golang package
    file: path=/tmp/golang.tar.gz state=absent
  
  when: version_check_result.rc!=0